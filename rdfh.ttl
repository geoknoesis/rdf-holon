@prefix h:   <http://www.w3.org/ns/rdfh#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh:  <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .

#################################################################
# Ontology Header
#################################################################

h: a owl:Ontology ;
    rdfs:label "RDF-H - Holon Extensions Vocabulary"@en ;
    rdfs:comment "This vocabulary defines the classes, properties, and SHACL extensions for representing and validating holonic graphs."@en ;
    owl:versionIRI <http://www.w3.org/ns/rdfh#1.0> ;
    dct:creator [
        a foaf:Person ;
        foaf:name "Stephane Fellah" ;
        foaf:workplaceHomepage <https://geoknoesis.com>
    ] .

#################################################################
# Core Classes
#################################################################

h:Holon a rdfs:Class ;
    rdfs:subClassOf rdfs:Resource ;
    rdfs:label "Holon"@en ;
    rdfs:comment "A resource that may act as both a whole and a part within a holarchy."@en .

#################################################################
# Generic Super-Property
#################################################################

h:holonLink a owl:ObjectProperty ;
    rdfs:label "holonic link"@en ;
    rdfs:comment "Any relationship between two holons in a holarchy."@en .

#################################################################
# Holonic Link Primitives
#################################################################

# Containment
h:containedIn a owl:ObjectProperty ;
    rdfs:subPropertyOf h:holonLink ;
    rdfs:label "is contained in"@en ;
    rdfs:comment "Reified containment relationship from a part to a whole."@en ;
    owl:inverseOf h:contains .

h:contains a owl:ObjectProperty, owl:TransitiveProperty ;
    rdfs:subPropertyOf h:holonLink ;
    rdfs:label "contains"@en ;
    rdfs:comment "Inverse of h:containedIn; from a whole to a part."@en .

# Hierarchy
h:hierarchyParent a owl:ObjectProperty, owl:TransitiveProperty ;
    rdfs:subPropertyOf h:holonLink ;
    rdfs:label "hierarchy parent"@en ;
    rdfs:comment "Represents a general hierarchical superordinate relationship."@en ;
    owl:inverseOf h:hierarchyChild .

h:hierarchyChild a owl:ObjectProperty ;
    rdfs:subPropertyOf h:holonLink ;
    rdfs:label "hierarchy child"@en ;
    rdfs:comment "Represents a general hierarchical subordinate relationship."@en .

# Membership
h:memberOf a owl:ObjectProperty ;
    rdfs:subPropertyOf h:holonLink ;
    rdfs:label "member of"@en ;
    rdfs:comment "Indicates group membership or loose association."@en ;
    owl:inverseOf h:hasMember .

h:hasMember a owl:ObjectProperty ;
    rdfs:subPropertyOf h:holonLink ;
    rdfs:label "has member"@en ;
    rdfs:comment "Inverse of h:memberOf."@en .

# Peer Relationship
h:peerOf a owl:ObjectProperty, owl:SymmetricProperty, owl:IrreflexiveProperty ;
    rdfs:subPropertyOf h:holonLink ;
    rdfs:label "peer of"@en ;
    rdfs:comment "Lateral, symmetric coordination."@en .

# Dependency
h:dependsOn a owl:ObjectProperty, owl:AsymmetricProperty ;
    rdfs:subPropertyOf h:holonLink ;
    rdfs:label "depends on"@en ;
    rdfs:comment "Functional or temporal prerequisite."@en ;
    owl:inverseOf h:requiredBy .

h:requiredBy a owl:ObjectProperty ;
    rdfs:subPropertyOf h:holonLink ;
    rdfs:label "required by"@en ;
    rdfs:comment "Inverse of h:dependsOn."@en .

#################################################################
# Holonic Link Graph
#################################################################

h:HolonicLinkGraph a rdfs:Class ;
    rdfs:label "Holonic Link Graph"@en ;
    rdfs:comment "A special graph context for serializing holonic link assertions."@en .

#################################################################
# SHACL-H Constraint Component Definitions
#################################################################

# -- Acyclicity Constraint (for containment & hierarchy)
h:AcyclicHolonicLinkConstraintComponent a sh:ConstraintComponent ;
    rdfs:label "Acyclic Holonic Link Constraint Component"@en ;
    rdfs:comment "Validates that a holon is not part of a cycle in containment or hierarchy links."@en ;
    sh:validator h:AcyclicHolonicLinkValidator .

h:AcyclicHolonicLinkValidator a sh:SPARQLValidator ;
    sh:message "The focus node participates in a containment or hierarchy cycle."@en ;
    sh:select """
        PREFIX h: <http://www.w3.org/ns/rdfh#>
        ASK {
            GRAPH h:HolonicLinkGraph {
                $this (h:containedIn|h:hierarchyChild)+ $this .
            }
        }
    """ .

# -- Holon Type Constraint --
h:HolonConstraintComponent a sh:ConstraintComponent ;
    rdfs:label "Holon Type Constraint Component"@en ;
    rdfs:comment "Checks if a resource acting as a container is explicitly typed as h:Holon."@en ;
    sh:validator h:HolonTypeValidator .

h:HolonTypeValidator a sh:SPARQLValidator ;
    sh:message "The focus node is used as a container but is not explicitly typed as h:Holon."@en ;
    sh:select """
        PREFIX h: <http://www.w3.org/ns/rdfh#>
        ASK {
            GRAPH h:HolonicLinkGraph {
                ?part (h:containedIn|h:hierarchyChild|h:hasMember|h:requiredBy) $this .
            }
            FILTER NOT EXISTS { $this a h:Holon . }
        }
    """ .
